<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>微信公众号入门 | notes | Kisstar</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="Kisstar's personal notes">
    <link rel="preload" href="/notebook/assets/css/0.styles.ba285c9d.css" as="style"><link rel="preload" href="/notebook/assets/js/app.695981a2.js" as="script"><link rel="preload" href="/notebook/assets/js/1.7e5e7c03.js" as="script"><link rel="preload" href="/notebook/assets/js/158.141c4127.js" as="script"><link rel="prefetch" href="/notebook/assets/js/10.5555a36f.js"><link rel="prefetch" href="/notebook/assets/js/100.f759079e.js"><link rel="prefetch" href="/notebook/assets/js/101.4fe3f882.js"><link rel="prefetch" href="/notebook/assets/js/102.0bbcc40c.js"><link rel="prefetch" href="/notebook/assets/js/103.90fb8e92.js"><link rel="prefetch" href="/notebook/assets/js/104.2613f631.js"><link rel="prefetch" href="/notebook/assets/js/105.1904e1fe.js"><link rel="prefetch" href="/notebook/assets/js/106.d4b86328.js"><link rel="prefetch" href="/notebook/assets/js/107.73982f13.js"><link rel="prefetch" href="/notebook/assets/js/108.2506538f.js"><link rel="prefetch" href="/notebook/assets/js/109.f6883728.js"><link rel="prefetch" href="/notebook/assets/js/11.80c95b7f.js"><link rel="prefetch" href="/notebook/assets/js/110.4107267a.js"><link rel="prefetch" href="/notebook/assets/js/111.5a9ced4c.js"><link rel="prefetch" href="/notebook/assets/js/112.52c3ae0d.js"><link rel="prefetch" href="/notebook/assets/js/113.2c286cc0.js"><link rel="prefetch" href="/notebook/assets/js/114.d91302a3.js"><link rel="prefetch" href="/notebook/assets/js/115.066e05bf.js"><link rel="prefetch" href="/notebook/assets/js/116.f4902c30.js"><link rel="prefetch" href="/notebook/assets/js/117.1089d492.js"><link rel="prefetch" href="/notebook/assets/js/118.45a6de9c.js"><link rel="prefetch" href="/notebook/assets/js/119.d27d6f1c.js"><link rel="prefetch" href="/notebook/assets/js/12.a4370376.js"><link rel="prefetch" href="/notebook/assets/js/120.3a7544cf.js"><link rel="prefetch" href="/notebook/assets/js/121.e030c429.js"><link rel="prefetch" href="/notebook/assets/js/122.20d28e30.js"><link rel="prefetch" href="/notebook/assets/js/123.4ca971e2.js"><link rel="prefetch" href="/notebook/assets/js/124.dc81944f.js"><link rel="prefetch" href="/notebook/assets/js/125.9c84d174.js"><link rel="prefetch" href="/notebook/assets/js/126.3ceca69a.js"><link rel="prefetch" href="/notebook/assets/js/127.d785ce87.js"><link rel="prefetch" href="/notebook/assets/js/128.ded8a375.js"><link rel="prefetch" href="/notebook/assets/js/129.98f7f226.js"><link rel="prefetch" href="/notebook/assets/js/13.8382045a.js"><link rel="prefetch" href="/notebook/assets/js/130.e591be27.js"><link rel="prefetch" href="/notebook/assets/js/131.9b6eb4fd.js"><link rel="prefetch" href="/notebook/assets/js/132.9b58abc7.js"><link rel="prefetch" href="/notebook/assets/js/133.90f097b7.js"><link rel="prefetch" href="/notebook/assets/js/134.16d3fa5f.js"><link rel="prefetch" href="/notebook/assets/js/135.6b326d91.js"><link rel="prefetch" href="/notebook/assets/js/136.494c3bd6.js"><link rel="prefetch" href="/notebook/assets/js/137.766b0b1f.js"><link rel="prefetch" href="/notebook/assets/js/138.08806114.js"><link rel="prefetch" href="/notebook/assets/js/139.0865299b.js"><link rel="prefetch" href="/notebook/assets/js/14.74c5da83.js"><link rel="prefetch" href="/notebook/assets/js/140.44e67ab5.js"><link rel="prefetch" href="/notebook/assets/js/141.1d1140ec.js"><link rel="prefetch" href="/notebook/assets/js/142.3cec12cd.js"><link rel="prefetch" href="/notebook/assets/js/143.dc8cbbbb.js"><link rel="prefetch" href="/notebook/assets/js/144.6ff451a3.js"><link rel="prefetch" href="/notebook/assets/js/145.c11d2acb.js"><link rel="prefetch" href="/notebook/assets/js/146.e5d225b6.js"><link rel="prefetch" href="/notebook/assets/js/147.c219c2a1.js"><link rel="prefetch" href="/notebook/assets/js/148.6cba05ca.js"><link rel="prefetch" href="/notebook/assets/js/149.4367d290.js"><link rel="prefetch" href="/notebook/assets/js/15.862c4dd8.js"><link rel="prefetch" href="/notebook/assets/js/150.1d38502b.js"><link rel="prefetch" href="/notebook/assets/js/151.ebae6be4.js"><link rel="prefetch" href="/notebook/assets/js/152.7675d7f0.js"><link rel="prefetch" href="/notebook/assets/js/153.e5aa90e2.js"><link rel="prefetch" href="/notebook/assets/js/154.f2a6e85f.js"><link rel="prefetch" href="/notebook/assets/js/155.c857ce10.js"><link rel="prefetch" href="/notebook/assets/js/156.63fe524f.js"><link rel="prefetch" href="/notebook/assets/js/157.782f4bda.js"><link rel="prefetch" href="/notebook/assets/js/159.db9dc02b.js"><link rel="prefetch" href="/notebook/assets/js/16.151452c5.js"><link rel="prefetch" href="/notebook/assets/js/160.7bda9824.js"><link rel="prefetch" href="/notebook/assets/js/161.c0b105a1.js"><link rel="prefetch" href="/notebook/assets/js/162.ad132d74.js"><link rel="prefetch" href="/notebook/assets/js/17.0587d61f.js"><link rel="prefetch" href="/notebook/assets/js/18.4d2b05f7.js"><link rel="prefetch" href="/notebook/assets/js/19.8cb4d2c4.js"><link rel="prefetch" href="/notebook/assets/js/20.01878a40.js"><link rel="prefetch" href="/notebook/assets/js/21.69361956.js"><link rel="prefetch" href="/notebook/assets/js/22.fe7d91ac.js"><link rel="prefetch" href="/notebook/assets/js/23.f8465087.js"><link rel="prefetch" href="/notebook/assets/js/24.922b6297.js"><link rel="prefetch" href="/notebook/assets/js/25.c43768cb.js"><link rel="prefetch" href="/notebook/assets/js/26.043f1db4.js"><link rel="prefetch" href="/notebook/assets/js/27.9ef023fd.js"><link rel="prefetch" href="/notebook/assets/js/28.9636beff.js"><link rel="prefetch" href="/notebook/assets/js/29.91916113.js"><link rel="prefetch" href="/notebook/assets/js/3.b70f0b3f.js"><link rel="prefetch" href="/notebook/assets/js/30.65aed714.js"><link rel="prefetch" href="/notebook/assets/js/31.08345366.js"><link rel="prefetch" href="/notebook/assets/js/32.0068cefa.js"><link rel="prefetch" href="/notebook/assets/js/33.744c5b33.js"><link rel="prefetch" href="/notebook/assets/js/34.5f64f72e.js"><link rel="prefetch" href="/notebook/assets/js/35.87a400e4.js"><link rel="prefetch" href="/notebook/assets/js/36.b0ea269e.js"><link rel="prefetch" href="/notebook/assets/js/37.7b90c95f.js"><link rel="prefetch" href="/notebook/assets/js/38.19a82643.js"><link rel="prefetch" href="/notebook/assets/js/39.abd4cb3c.js"><link rel="prefetch" href="/notebook/assets/js/4.02b78e18.js"><link rel="prefetch" href="/notebook/assets/js/40.e00b1569.js"><link rel="prefetch" href="/notebook/assets/js/41.5889ce56.js"><link rel="prefetch" href="/notebook/assets/js/42.0bf17165.js"><link rel="prefetch" href="/notebook/assets/js/43.449d90d0.js"><link rel="prefetch" href="/notebook/assets/js/44.c6a48e91.js"><link rel="prefetch" href="/notebook/assets/js/45.a1d21b57.js"><link rel="prefetch" href="/notebook/assets/js/46.c96f7f00.js"><link rel="prefetch" href="/notebook/assets/js/47.82a7b3c0.js"><link rel="prefetch" href="/notebook/assets/js/48.d614f857.js"><link rel="prefetch" href="/notebook/assets/js/49.1c852f85.js"><link rel="prefetch" href="/notebook/assets/js/5.aca53e6b.js"><link rel="prefetch" href="/notebook/assets/js/50.515b01de.js"><link rel="prefetch" href="/notebook/assets/js/51.0f9a7a02.js"><link rel="prefetch" href="/notebook/assets/js/52.1202f062.js"><link rel="prefetch" href="/notebook/assets/js/53.31c3a9c5.js"><link rel="prefetch" href="/notebook/assets/js/54.8b169b8e.js"><link rel="prefetch" href="/notebook/assets/js/55.9b7df2f0.js"><link rel="prefetch" href="/notebook/assets/js/56.4e1f287a.js"><link rel="prefetch" href="/notebook/assets/js/57.9515797e.js"><link rel="prefetch" href="/notebook/assets/js/58.3fbe5aac.js"><link rel="prefetch" href="/notebook/assets/js/59.898334ad.js"><link rel="prefetch" href="/notebook/assets/js/6.ae5c2b7f.js"><link rel="prefetch" href="/notebook/assets/js/60.842f6d02.js"><link rel="prefetch" href="/notebook/assets/js/61.46faa661.js"><link rel="prefetch" href="/notebook/assets/js/62.c6d6e425.js"><link rel="prefetch" href="/notebook/assets/js/63.97adbd06.js"><link rel="prefetch" href="/notebook/assets/js/64.1b88dee7.js"><link rel="prefetch" href="/notebook/assets/js/65.54d6c336.js"><link rel="prefetch" href="/notebook/assets/js/66.f1ddc697.js"><link rel="prefetch" href="/notebook/assets/js/67.3ce55620.js"><link rel="prefetch" href="/notebook/assets/js/68.178403c5.js"><link rel="prefetch" href="/notebook/assets/js/69.356702b3.js"><link rel="prefetch" href="/notebook/assets/js/7.851811b0.js"><link rel="prefetch" href="/notebook/assets/js/70.d4f2df1b.js"><link rel="prefetch" href="/notebook/assets/js/71.ea0d3661.js"><link rel="prefetch" href="/notebook/assets/js/72.42a2f1c4.js"><link rel="prefetch" href="/notebook/assets/js/73.351005ef.js"><link rel="prefetch" href="/notebook/assets/js/74.1bc0f519.js"><link rel="prefetch" href="/notebook/assets/js/75.186107dd.js"><link rel="prefetch" href="/notebook/assets/js/76.a30fddd4.js"><link rel="prefetch" href="/notebook/assets/js/77.548802cd.js"><link rel="prefetch" href="/notebook/assets/js/78.695d98cd.js"><link rel="prefetch" href="/notebook/assets/js/79.1f195e5d.js"><link rel="prefetch" href="/notebook/assets/js/8.6629bfc2.js"><link rel="prefetch" href="/notebook/assets/js/80.7e5bf821.js"><link rel="prefetch" href="/notebook/assets/js/81.1aef26c7.js"><link rel="prefetch" href="/notebook/assets/js/82.98fb7874.js"><link rel="prefetch" href="/notebook/assets/js/83.cb222248.js"><link rel="prefetch" href="/notebook/assets/js/84.490eeeb4.js"><link rel="prefetch" href="/notebook/assets/js/85.f6d0b63d.js"><link rel="prefetch" href="/notebook/assets/js/86.92a3a079.js"><link rel="prefetch" href="/notebook/assets/js/87.39b4bda3.js"><link rel="prefetch" href="/notebook/assets/js/88.bf7ab095.js"><link rel="prefetch" href="/notebook/assets/js/89.99ace825.js"><link rel="prefetch" href="/notebook/assets/js/9.93ce6aed.js"><link rel="prefetch" href="/notebook/assets/js/90.17093654.js"><link rel="prefetch" href="/notebook/assets/js/91.4913cc92.js"><link rel="prefetch" href="/notebook/assets/js/92.37a40f65.js"><link rel="prefetch" href="/notebook/assets/js/93.f1f887df.js"><link rel="prefetch" href="/notebook/assets/js/94.f1db30fd.js"><link rel="prefetch" href="/notebook/assets/js/95.a61036d2.js"><link rel="prefetch" href="/notebook/assets/js/96.ed173e16.js"><link rel="prefetch" href="/notebook/assets/js/97.765420ba.js"><link rel="prefetch" href="/notebook/assets/js/98.29fddfc0.js"><link rel="prefetch" href="/notebook/assets/js/99.9e475ad7.js">
    <link rel="stylesheet" href="/notebook/assets/css/0.styles.ba285c9d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notebook/" class="home-link router-link-active"><img src="/notebook/logo.png" alt="notes | Kisstar" class="logo"> <span class="site-name can-hide">notes | Kisstar</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT" class="dropdown-title"><span class="title">IT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          FED
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/notebook/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/notebook/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/notebook/ts/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/notebook/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/notebook/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/notebook/web/" class="nav-link">
  WEB
</a></li></ul></li><li class="dropdown-item"><h4>
          BED
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/nodejs/" class="nav-link">
  NodeJS
</a></li><li class="dropdown-subitem"><a href="/notebook/webpack/" class="nav-link">
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          OTHER
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/wechat/" class="nav-link router-link-active">
  WeChat
</a></li><li class="dropdown-subitem"><a href="/notebook/project/" class="nav-link">
  Project
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevTools" class="dropdown-title"><span class="title">DevTools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/notebook/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/notebook/vim/" class="nav-link">
  Vim
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Computer" class="dropdown-title"><span class="title">Computer</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/cp/" class="nav-link">
  Computer Basis
</a></li><li class="dropdown-item"><!----> <a href="/notebook/algorithm/" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/notebook/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/notebook/windows/" class="nav-link">
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/" class="nav-link">
  Database
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Cloud" class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/notebook/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/notebook/dev-ops/" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><a href="/notebook/collection/" class="nav-link">
  Collection
</a></div><div class="nav-item"><a href="/notebook/other/" class="nav-link">
  Other
</a></div><div class="nav-item"><a href="https://github.com/kisstar/notebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT" class="dropdown-title"><span class="title">IT</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          FED
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/notebook/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/notebook/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/notebook/ts/" class="nav-link">
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/notebook/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/notebook/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/notebook/web/" class="nav-link">
  WEB
</a></li></ul></li><li class="dropdown-item"><h4>
          BED
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/nodejs/" class="nav-link">
  NodeJS
</a></li><li class="dropdown-subitem"><a href="/notebook/webpack/" class="nav-link">
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>
          OTHER
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/notebook/wechat/" class="nav-link router-link-active">
  WeChat
</a></li><li class="dropdown-subitem"><a href="/notebook/project/" class="nav-link">
  Project
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="DevTools" class="dropdown-title"><span class="title">DevTools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/notebook/vscode/" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/notebook/vim/" class="nav-link">
  Vim
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Computer" class="dropdown-title"><span class="title">Computer</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/cp/" class="nav-link">
  Computer Basis
</a></li><li class="dropdown-item"><!----> <a href="/notebook/algorithm/" class="nav-link">
  Algorithm
</a></li><li class="dropdown-item"><!----> <a href="/notebook/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/notebook/windows/" class="nav-link">
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/notebook/database/" class="nav-link">
  Database
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Cloud" class="dropdown-title"><span class="title">Cloud</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notebook/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/notebook/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/notebook/dev-ops/" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><a href="/notebook/collection/" class="nav-link">
  Collection
</a></div><div class="nav-item"><a href="/notebook/other/" class="nav-link">
  Other
</a></div><div class="nav-item"><a href="https://github.com/kisstar/notebook/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notebook/wechat/" aria-current="page" class="sidebar-link">WeChat</a></li><li><a href="/notebook/wechat/basis/offiaccount.html" aria-current="page" class="active sidebar-link">微信公众号入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#环境" class="sidebar-link">环境</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#验证消息的确来自微信服务器" class="sidebar-link">验证消息的确来自微信服务器</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#申请微信公众帐号测试号" class="sidebar-link">申请微信公众帐号测试号</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#接受微信消息" class="sidebar-link">接受微信消息</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#获取-access-token" class="sidebar-link">获取 Access token</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#网页授权" class="sidebar-link">网页授权</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#jwt" class="sidebar-link">JWT</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#jssdk" class="sidebar-link">JSSDK</a></li><li class="sidebar-sub-header"><a href="/notebook/wechat/basis/offiaccount.html#参考" class="sidebar-link">参考</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微信公众号入门"><a href="#微信公众号入门" class="header-anchor">#</a> 微信公众号入门</h1> <p>微信公众平台是运营者通过公众号为微信用户提供资讯和服务的平台。</p> <p>公众平台开发接口是提供服务的基础，开发者在公众平台网站中创建公众号、获取接口权限后，可以通过阅读本接口文档来帮助开发。</p> <h2 id="环境"><a href="#环境" class="header-anchor">#</a> 环境</h2> <ul><li><a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener noreferrer">注册微信订阅号<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener noreferrer">安装微信开发者工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.ngrok.cc/" target="_blank" rel="noopener noreferrer">sunny-ngrok<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 工具的安装和注册</li></ul> <p>对于 <code>sunny-ngrok</code>，需要首先前往其<a href="https://www.ngrok.cc/" target="_blank" rel="noopener noreferrer">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，然后注册一个账户并登录。</p> <p>点击左边栏的开通隧道，选择一个隧道进行开通（其中提供了一个免费的 Ngrok 服务器）。开通时需要填写以下信息：</p> <ul><li>隧道名称：普通的昵称，可随意填写</li> <li>前置域名：服务器免费赠送的域名，填写时不要带上后缀，如需注册 <code>sunny.free.idcfengye.com</code> 只需要填写 <code>sunny</code></li> <li>本地端口：可以为同一个局域网内任意一台机器进行映射，只需要填对 IP 和端口就行，例如：<code>172.0.0.1:80</code></li></ul> <p>接着前往下载页面<a href="https://www.ngrok.cc/download.html" target="_blank" rel="noopener noreferrer">下载客户端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（一个可执行文件），完成之后就可以执行了：</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 启动隧道</span>
./sunny clientid <span class="token operator">&lt;</span>隧道_ID<span class="token operator">&gt;</span>
</code></pre></div><p>启动成功后，按照上面的说明，在互联网中访问 <code>sunny.free.idcfengye.com</code> 相当于访问你本机上的 80 端口。</p> <h2 id="验证消息的确来自微信服务器"><a href="#验证消息的确来自微信服务器" class="header-anchor">#</a> 验证消息的确来自微信服务器</h2> <p>现在登录微信公众平台官网后，在公众平台官网的开发-基本设置页面，勾选协议成为开发者，点击“修改配置”按钮。</p> <p>配置服务器地址（也就是上面赠送的域名 + 接口路径）、Token（可任意填写，用作生成签名） 和 EncodingAESKey（可任意填写，将用作消息体加解密密钥）。</p> <p>提交后，微信服务器将发送 GET 请求到填写的服务器地址 URL 上，GET 请求携带参数如下表所示:</p> <ul><li><strong>signature</strong> 微信加密签名，<code>signature</code> 结合了开发者填写的 <code>token</code> 参数和请求中的 <code>timestamp</code> 参数、<code>nonce</code> 参数</li> <li><strong>timestamp</strong> 时间戳</li> <li><strong>nonce</strong> 随机数</li> <li><strong>echostr</strong> 随机字符串</li></ul> <p>开发者通过检验 <code>signature</code> 对请求进行校验，加密/校验流程如下：</p> <ul><li>将 <code>token</code>、<code>timestamp</code>、<code>nonce</code> 三个参数进行字典序排序</li> <li>将三个参数字符串拼接成一个字符串进行 <code>sha1</code> 加密</li> <li>将获得加密后的字符串与 <code>signature</code> 对比，标识该请求来源于微信</li></ul> <p>若确认此次 GET 请求来自微信服务器，就原样返回 <code>echostr</code> 参数内容，则接入生效，成为开发者成功，否则接入失败。</p> <p>同时，为了方便开发，消息加密方式可以先选择明文模式。选择兼容模式和安全模式需要提前配置好相关加解密代码，详情请参考<a href="https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Message_Encryption/Message_encryption_and_decryption.html" target="_blank" rel="noopener noreferrer">消息体签名及加解密部分的文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>成为开发者后，用户每次向公众号发送消息、或者产生自定义菜单、或产生微信支付订单等情况时，开发者填写的服务器配置 URL 将得到微信服务器推送过来的消息和事件。</p> <p>开发者可以依据自身业务逻辑进行响应，如回复消息。</p> <h2 id="申请微信公众帐号测试号"><a href="#申请微信公众帐号测试号" class="header-anchor">#</a> 申请微信公众帐号测试号</h2> <p>微信公众号的注册有一定门槛，某些高级接口的权限需要微信认证后才可以获取。为了快速了解和上手微信公众号开发，可以<a href="http://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index" target="_blank" rel="noopener noreferrer">前往<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>申请公众平台测试帐号。</p> <p>对于得到的测试号，在配置接口配置信息时会和上面一样进行认证，你需要在你的服务器上原样返回 <code>echostr</code> 参数内容来完成配置。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@koa/router'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span>

<span class="token comment">/* 配置 */</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN</span> <span class="token operator">=</span> <span class="token string">'TOKEN'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token parameter">nonce<span class="token punctuation">,</span> token<span class="token punctuation">,</span> timestamp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> srotedStr <span class="token operator">=</span> <span class="token punctuation">[</span>nonce<span class="token punctuation">,</span> token<span class="token punctuation">,</span> timestamp<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> _signature <span class="token operator">=</span> crypto
    <span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>srotedStr<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> _signature
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/wechat'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> nonce<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> echostr <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query
  <span class="token keyword">const</span> _signature <span class="token operator">=</span> <span class="token function">getSignature</span><span class="token punctuation">(</span>nonce<span class="token punctuation">,</span> <span class="token constant">TOKEN</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>signature <span class="token operator">===</span> _signature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> echostr
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span>
</code></pre></div><p>随后扫描页面下方的测试号二维码，关注公众号，以便后续的测试。</p> <h2 id="接受微信消息"><a href="#接受微信消息" class="header-anchor">#</a> 接受微信消息</h2> <p>当普通微信用户向公众账号发消息时，微信服务器将 POST 消息的 XML 数据包到开发者填写的 URL。开发者可以在响应包（Get）中返回特定 XML 结构，来对该消息进行响。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ...</span>
<span class="token keyword">const</span> getRawBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raw-body'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> parseString <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'xml2js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parseStringPromise
<span class="token keyword">const</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">TEMPLATE</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;xml&gt;
  &lt;ToUserName&gt;&lt;![CDATA[&lt;%-toUsername%&gt;]]&gt;&lt;/ToUserName&gt;
  &lt;FromUserName&gt;&lt;![CDATA[&lt;%-fromUsername%&gt;]]&gt;&lt;/FromUserName&gt;
  &lt;CreateTime&gt;&lt;%=createTime%&gt;&lt;/CreateTime&gt;
  &lt;MsgType&gt;&lt;![CDATA[&lt;%=msgType%&gt;]]&gt;&lt;/MsgType&gt;
  &lt;Content&gt;&lt;![CDATA[&lt;%-content%&gt;]]&gt;&lt;/Content&gt;
&lt;/xml&gt;
</span><span class="token template-punctuation string">`</span></span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/wechat'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> nonce<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> signature <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query
  <span class="token keyword">const</span> _signature <span class="token operator">=</span> <span class="token function">getSignature</span><span class="token punctuation">(</span>nonce<span class="token punctuation">,</span> <span class="token constant">TOKEN</span><span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>signature <span class="token operator">!==</span> _signature<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Invalid signature'</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getRawBody</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>req<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    length<span class="token operator">:</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'content-length'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    encoding<span class="token operator">:</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>charset<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> xml<span class="token operator">:</span> params <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">parseString</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token punctuation">{</span> trim<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> replyXML <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token constant">TEMPLATE</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    toUsername<span class="token operator">:</span> params<span class="token punctuation">.</span>FromUserName<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    fromUsername<span class="token operator">:</span> params<span class="token punctuation">.</span>ToUserName<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    createTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    msgType<span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> replyXML
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>回复图片（不支持 gif 动图）等多媒体消息时需要预先通过素材管理接口上传临时素材到微信服务器，可以使用素材管理中的临时素材，也可以使用永久素材。</p> <h2 id="获取-access-token"><a href="#获取-access-token" class="header-anchor">#</a> 获取 Access token</h2> <p><code>access_token</code> 是公众号的全局唯一接口调用凭据，公众号调用各接口时都需使用 <code>access_token</code>。</p> <p>开发者需要妥善保存 <code>access_token</code>，它的存储至少要保留 512 个 字符空间，有效期目前为 2 个小时，重复获取将导致上次获取的 <code>access_token</code> 失效。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ...</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">HOST</span> <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> <span class="token constant">PORT</span> <span class="token operator">=</span> <span class="token number">6379</span>
<span class="token keyword">const</span> <span class="token constant">APP_ID</span> <span class="token operator">=</span> <span class="token string">'APP_ID'</span>
<span class="token keyword">const</span> <span class="token constant">APP_SECRET</span> <span class="token operator">=</span> <span class="token string">'APP_SECRET'</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">createClient</span><span class="token punctuation">(</span><span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token constant">HOST</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">HGETALL</span> <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token constant">HGETALL</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span>
<span class="token keyword">const</span> hmset <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>hmset<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">HGETALL</span><span class="token punctuation">(</span><span class="token string">'tokenCache'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> access_token<span class="token punctuation">,</span> expires_in<span class="token punctuation">,</span> updateTime <span class="token punctuation">}</span> <span class="token operator">=</span> tokenInfo <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>access_token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>updateTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>expires_in<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token parameter">appId<span class="token punctuation">,</span> appSecret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">checkAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">HGETALL</span><span class="token punctuation">(</span><span class="token string">'tokenCache'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tokenInfo
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://api.weixin.qq.com/cgi-bin/token'</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      grant_type<span class="token operator">:</span> <span class="token string">'client_credential'</span><span class="token punctuation">,</span>
      appid<span class="token operator">:</span> appId<span class="token punctuation">,</span>
      secret<span class="token operator">:</span> appSecret<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> access_token<span class="token punctuation">,</span> expires_in<span class="token punctuation">,</span> errmsg <span class="token punctuation">}</span> <span class="token operator">=</span> data
  <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>errmsg<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
      access_token<span class="token punctuation">,</span>
      expires_in<span class="token punctuation">,</span>
      updateTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">await</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">'tokenCache'</span><span class="token punctuation">,</span> tokenInfo<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tokenInfo
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在这里会先读取 <code>redis</code> 中的 <code>access_token</code> 信息，如果存在且有效的话，就会直接使用现有的，否则将会通过微信提供的接口获取新的 <code>access_token</code>。</p> <h2 id="网页授权"><a href="#网页授权" class="header-anchor">#</a> 网页授权</h2> <p>如果用户在微信客户端中访问第三方网页，公众号可以通过微信网页授权机制，来获取用户基本信息，进而实现业务逻辑。</p> <p>微信网页授权是通过 OAuth2.0 机制实现的，在用户授权给公众号后，公众号可以获取到一个网页授权特有的接口调用凭证（网页授权 access_token）。</p> <p>通过网页授权 <code>access_token</code> 可以进行授权后接口调用，如获取用户基本信息。具体而言，网页授权流程分为四步：</p> <ol><li>引导用户进入授权页面同意授权，获取 <code>code</code></li> <li>通过 <code>code</code> 换取网页授权 <code>access_token</code></li> <li>如果需要，开发者可以刷新网页授权 <code>access_token</code>，避免过期</li> <li>通过网页授权 <code>access_token</code> 和 <code>openid</code> 获取用户基本信息</li></ol> <p>在微信公众号请求用户网页授权之前，开发者需要先到公众平台官网中的“开发 - 接口权限 - 网页服务 - 网页授权 - 网页授权获取用户基本信息”的配置选项中，修改授权回调域名。</p> <p>对于我们现在使用的测试账号，可以在测试号管理页面的相应位置进行配置。授权回调域名配置规范为不带 HTTP 协议的全域名（sunny.free.idcfengye.com）。</p> <p>现在创建一个简单的前台页面（public/index.html）：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>农府<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/vue/2.6.11/vue.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>https://cdn.bootcdn.net/ajax/libs/axios/0.19.2/axios.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      el<span class="token operator">:</span> <span class="token string">'#root'</span><span class="token punctuation">,</span>
      methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/auth'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> query <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
        location<span class="token punctuation">.</span>search
          <span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> tmpArr <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>
            query<span class="token punctuation">[</span>tmpArr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>tmpArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>query<span class="token punctuation">.</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 把 Token 保存到 localStorage 中。也可以保存当前时间，发起请求前做一个是否过期的判断</span>
        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> query<span class="token punctuation">.</span>token<span class="token punctuation">)</span>
        <span class="token comment">// 使用了 axios 的请求拦截器，每次请求都会把 token 放到 headers 中</span>
        axios<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">config</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span>
          config<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Bearer '</span> <span class="token operator">+</span> token
          <span class="token keyword">return</span> config
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>为了让前台可以访问，还需要做一点小小的配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>然后，打开微信开发者工具，点击公众号网页。在地址栏访问静态服务器的地址（如上面的 sunny.free.idcfengye.com）。由于没有首次进入没有 Token 就会请求我们的授权接口：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">REDIRECT_URI</span> <span class="token operator">=</span> <span class="token string">'http://sunny.free.idcfengye.com/auth_cb'</span>

<span class="token comment">/**
 * 获取授权页面的 URL 地址
 * @param {string} redirect 授权后要跳转的地址
 * @param {string} state 开发者可提供的数据
 * @param {string} scope 作用范围
 */</span>
<span class="token keyword">function</span> <span class="token function">getAuthURL</span><span class="token punctuation">(</span><span class="token parameter">appId<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> state<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://open.weixin.qq.com/connect/oauth2/authorize'</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
    appid<span class="token operator">:</span> appId<span class="token punctuation">,</span>
    redirect_uri<span class="token operator">:</span> redirect<span class="token punctuation">,</span>
    response_type<span class="token operator">:</span> <span class="token string">'code'</span><span class="token punctuation">,</span>
    scope<span class="token operator">:</span> scope <span class="token operator">||</span> <span class="token string">'snsapi_userinfo'</span><span class="token punctuation">,</span>
    state<span class="token operator">:</span> state <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#wechat_redirect</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> redirectURL <span class="token operator">=</span> <span class="token function">getAuthURL</span><span class="token punctuation">(</span><span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">REDIRECT_URI</span><span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>redirectURL<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在上面的代码中，我们根据微信给定的 URL 结构拼接除了授权页面的地址，并重定向到该地址。如果用户同意授权，页面将跳转至我们指定的重定向地址：<code>REDIRECT_URI/?code=CODE&amp;state=STATE</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 根据授权获取到的 code 获取 access_token</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getWEBAccessToken</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> appId<span class="token punctuation">,</span> appSecret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">checkAccessToken</span><span class="token punctuation">(</span><span class="token string">'webTokenCache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">HGETALL</span><span class="token punctuation">(</span><span class="token string">'webTokenCache'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tokenInfo
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>
    appid<span class="token operator">:</span> appId<span class="token punctuation">,</span>
    secret<span class="token operator">:</span> appSecret<span class="token punctuation">,</span>
    code<span class="token punctuation">,</span>
    grant_type<span class="token operator">:</span> <span class="token string">'authorization_code'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.weixin.qq.com/sns/oauth2/access_token?</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> webTokenInfo <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      accept<span class="token operator">:</span> <span class="token string">'application/json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">'webTokenCache'</span><span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> updateTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> webTokenInfo<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> webTokenInfo
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth_cb'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> code <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>code <span class="token comment">// 微信回调此接口时回携带 code 参数</span>
  <span class="token keyword">const</span> webTokenInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getWEBAccessToken</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_SECRET</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> openid <span class="token punctuation">}</span> <span class="token operator">=</span> webTokenInfo
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里处理的逻辑和之前获取 <code>access_token</code> 的逻辑基本一致，首先根据拿到的 CODE 和 APP_ID 等信息获取 <code>access_token</code> 并存储在 Redis 中，下次获取前先判断是否过期。</p> <h2 id="jwt"><a href="#jwt" class="header-anchor">#</a> JWT</h2> <p>由于从微信获取的 <code>access_token</code> 的安全级别非常高，所以不能直接传递给客户端。因此我们需要自己维护一套登录机制，JWT 可以做到这一点。</p> <p>首先，在我们设置的微信回调接口处，我们拿到登录的 <code>access_token</code> 后就可以通过调用 <code>jsonwebtoken</code> 的 <code>sign()</code> 方法来生成 <code>token</code>，然后传递给前台：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token constant">TOKEN_PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token string">'TOKEN_PRIVATE_KEY'</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/auth_cb'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> openid <span class="token punctuation">}</span> <span class="token operator">=</span> webTokenInfo
  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      openid<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token constant">TOKEN_PRIVATE_KEY</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> expiresIn<span class="token operator">:</span> <span class="token string">'2h'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/?token=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>为了完善鉴权，可以引入 <code>koa-jwt</code> 中间件来进行验证：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> koaJwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-jwt'</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Protected resource, please log in first'</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> err
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">koaJwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span> secret<span class="token operator">:</span> <span class="token constant">TOKEN_PRIVATE_KEY</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex">/^\/$/</span><span class="token punctuation">,</span> <span class="token regex">/^\/wechat$/</span><span class="token punctuation">,</span> <span class="token regex">/^\/auth$/</span><span class="token punctuation">,</span> <span class="token regex">/^\/auth_cb$/</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div><p>如此，一个简单的 JWT 认证机制就算完成了。</p> <p>这里演示的只有一个用户，如果是多个用户在存储获取的 Token 信息时可以以对应的 <code>openid</code> 作为 <code>key</code>。同时用户请求时，我们也可以读取 JWT 中的内容来确认当前请求的用户。</p> <h2 id="jssdk"><a href="#jssdk" class="header-anchor">#</a> JSSDK</h2> <p>微信 JS-SDK 是微信公众平台 面向网页开发者提供的基于微信内的网页开发工具包。</p> <p>通过使用微信 JS-SDK，网页开发者可借助微信高效地使用拍照、选图、语音、位置等手机系统的能力，同时可以直接使用微信分享、扫一扫、卡券、支付等微信特有的能力。</p> <p>要使用 JS-SDK，你需要：</p> <ul><li>先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS 接口安全域名”</li> <li>在页面引入相应的 JS 文件</li> <li>通过 <code>config</code> 接口注入权限验证配置</li></ul> <p>第三部权限验证必须先通过后台拿到对应的参数，所以在前面 JWT 的基础上，如果前台已经获取到了 Token，那么就直接发送请求获取相应的参数：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- .... --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://res.wx.qq.com/open/js/jweixin-1.6.0.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      el<span class="token operator">:</span> <span class="token string">'#root'</span><span class="token punctuation">,</span>
      methods<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function">auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'/auth'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">async</span> <span class="token function">getJSConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getJSConfig'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            params<span class="token operator">:</span> <span class="token punctuation">{</span>
              url<span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getJSConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>后台根据<a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62" target="_blank" rel="noopener noreferrer">要求<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>获取并回应，其中涉及到了 <code>jsapi_ticket</code>，和之前 <code>access_token</code> 的处理基本一直：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 排序并返回处理后的字符串</span>
<span class="token keyword">function</span> <span class="token function">raw</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
  <span class="token keyword">const</span> newArgs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  keys <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> key <span class="token operator">=</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    newArgs<span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> string <span class="token operator">=</span> <span class="token string">''</span>
  <span class="token keyword">const</span> newKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>newArgs<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> newKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> k <span class="token operator">=</span> newKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    string <span class="token operator">+=</span> <span class="token string">'&amp;'</span> <span class="token operator">+</span> k <span class="token operator">+</span> <span class="token string">'='</span> <span class="token operator">+</span> newArgs<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> string<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * 签名算法
 * @param {string} nonceStr随机字符串
 * @param {string} jsapi_ticket 公众号用于调用微信 JS 接口的临时票据
 * @param {string} timestamp 时间戳
 * @param {string} url 当前网页的 URL，不包含 # 及其后面部分
 */</span>
<span class="token keyword">function</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token parameter">nonceStr<span class="token punctuation">,</span> jsapi_ticket<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token punctuation">{</span>
    jsapi_ticket<span class="token operator">:</span> jsapi_ticket<span class="token punctuation">,</span>
    nonceStr<span class="token operator">:</span> nonceStr<span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> timestamp<span class="token punctuation">,</span>
    url<span class="token operator">:</span> url<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> string <span class="token operator">=</span> <span class="token function">raw</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
  <span class="token keyword">const</span> retStr <span class="token operator">=</span> crypto
    <span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'sha1'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> retStr
<span class="token punctuation">}</span>

<span class="token comment">// 获取 jsapi_ticket</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getJsApiTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">checkAccessToken</span><span class="token punctuation">(</span><span class="token string">'ticketCache'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ticketInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token constant">HGETALL</span><span class="token punctuation">(</span><span class="token string">'ticketCache'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> ticketInfo
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://api.weixin.qq.com/cgi-bin/ticket/getticket'</span>
  <span class="token keyword">const</span> tokenInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token constant">APP_ID</span><span class="token punctuation">,</span> <span class="token constant">APP_SECRET</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> ticketRet <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      access_token<span class="token operator">:</span> tokenInfo<span class="token punctuation">.</span>access_token<span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token string">'jsapi'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ticketInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    access_token<span class="token operator">:</span> ticketRet<span class="token punctuation">.</span>ticket<span class="token punctuation">,</span>
    expires_in<span class="token operator">:</span> ticketRet<span class="token punctuation">.</span>expires_in<span class="token punctuation">,</span>
    updateTime<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">'ticketCache'</span><span class="token punctuation">,</span> ticketInfo<span class="token punctuation">)</span>
  <span class="token keyword">return</span> ticketInfo
<span class="token punctuation">}</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getJsConfig'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html#62</span>
  <span class="token keyword">const</span> ticketInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getJsApiTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> nonceStr <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> jsAPITicket <span class="token operator">=</span> ticketInfo<span class="token punctuation">.</span>access_token
  <span class="token keyword">const</span> timestamp <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">''</span>
  <span class="token keyword">const</span> signature <span class="token operator">=</span> <span class="token function">sign</span><span class="token punctuation">(</span>nonceStr<span class="token punctuation">,</span> jsAPITicket<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">.</span>url<span class="token punctuation">)</span>

  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    debug<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    appId<span class="token operator">:</span> <span class="token constant">APP_ID</span><span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> timestamp<span class="token punctuation">,</span>
    nonceStr<span class="token operator">:</span> nonceStr<span class="token punctuation">,</span>
    signature<span class="token operator">:</span> signature<span class="token punctuation">,</span>
    jsApiList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>前台拿到了关键信息，现在就可以开始通过 <code>config</code> 接口注入权限验证配置：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ...</span>
<span class="token keyword">async</span> <span class="token function">getJSConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/getJSConfig'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    params<span class="token operator">:</span> <span class="token punctuation">{</span>
      url<span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  wx<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启调试模式</span>
    appId<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 必填，公众号的唯一标识</span>
    timestamp<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的时间戳</span>
    nonceStr<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的随机串</span>
    signature<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 必填，签名</span>
    jsApiList<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 必填，需要使用的JS接口列表</span>
    <span class="token operator">...</span>res<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>后续通过 <code>ready</code> 接口处理成功验证，也就是说 <code>config</code> 信息验证后会自动执行 <code>ready</code> 方法。</p> <p>所有接口调用都必须在 <code>config</code> 接口获得结果之后，<code>config</code> 是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在 <code>ready</code> 函数中调用来确保正确执行。</p> <p>对于用户触发时才调用的接口，则可以直接调用，不需要放在 <code>ready</code> 函数中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>wx<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>另外，你还可以通过 <code>error</code> 接口处理失败验证。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://kf.qq.com/faq/120911VrYVrA15091832Qzqq.html?scene_id=kf3384" target="_blank" rel="noopener noreferrer">什么是订阅号？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html" target="_blank" rel="noopener noreferrer">接入概述 | 微信开放文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ngrok.cc/_book/" target="_blank" rel="noopener noreferrer">Sunny-Ngrok 使用教程 · Sunny-Ngrok 说明文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/creeperyang/koa-xml-body" target="_blank" rel="noopener noreferrer">GitHub - creeperyang/koa-xml-body: koa middleware to parse xml request body<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/stream-utils/raw-body" target="_blank" rel="noopener noreferrer">GitHub - stream-utils/raw-body: Get and validate the raw body of a readable stream<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Leonidas-from-XIV/node-xml2js" target="_blank" rel="noopener noreferrer">GitHub - Leonidas-from-XIV/node-xml2js: XML to JavaScript object converter.<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Receiving_standard_messages.html" target="_blank" rel="noopener noreferrer">文本消息 | 微信开放文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html" target="_blank" rel="noopener noreferrer">回复文本消息 | 微信开放文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://ejs.bootcss.com/" target="_blank" rel="noopener noreferrer">EJS -- 嵌入式 JavaScript 模板引擎 | EJS 中文文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/lin-xin/blog/issues/28" target="_blank" rel="noopener noreferrer">Node.js 应用：Koa2 使用 JWT 进行鉴权 · Issue #28 · lin-xin/blog · GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developers.weixin.qq.com/doc/offiaccount/OA_Web_Apps/JS-SDK.html" target="_blank" rel="noopener noreferrer">JS - SDK 说明文档 | 微信开放文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notebook/wechat/" class="prev router-link-active">
        WeChat
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notebook/assets/js/app.695981a2.js" defer></script><script src="/notebook/assets/js/1.7e5e7c03.js" defer></script><script src="/notebook/assets/js/158.141c4127.js" defer></script>
  </body>
</html>
