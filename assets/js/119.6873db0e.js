(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{538:function(t,s,a){"use strict";a.r(s);var n=a(62),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("p",[t._v("要安装预编译的 Electron 二进制文件，首选方法是在你的应用程序中安装 Electron 作为开发依赖：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" electron --dev\n")])])]),a("p",[t._v("实际安装时经常会遇到如下错误：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" electron@13.1.0 postinstall D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("newelectron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("electron\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("node")]),t._v(" install.js\n Downloading electron-v13.1.0-win32-x64.zip: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("% ETA: "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(" seconds\nHTTPError: Response code "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Gateway Time-out"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at EventEmitter."),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("anonymous"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("as-stream.js:\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("35")]),t._v(":24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at EventEmitter.emit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events.js:210:5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at module.exports "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("get-response.js:22:10"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at ClientRequest.handleResponse "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("got"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("request-as-\n event-emitter.js:155:5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at Object.onceWrapper "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events.js:300:26"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at ClientRequest.emit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("events.js:215:7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at ClientRequest.origin.emit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("D:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("@szmarczak"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("http-timer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("index.js:37:11"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at HTTPParser.parserOnIncomingClient "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("as onIncoming"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_http_client.js:583:27"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at HTTPParser.parserOnHeadersComplete "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_http_common.js:115:17"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n at Socket.socketOnData "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_http_client.js:456:22"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" WARN newelectron@1.0.0 No description\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" WARN newelectron@1.0.0 No repository f ield.\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" code ELIFECYCLE\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" errno "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" electron@13.1.0 postinstall: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node install.js'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Exit status "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" Failed at the electron@13.1.0 postinstall script.\n "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v(" This is probably not a problem with npm. There is likely additional\n logging output above.\n")])])]),a("p",[t._v("如倒数第 6 行所示，该包利用了 Npm 的 "),a("code",[t._v("postinstall")]),t._v(" 钩子，除了 "),a("code",[t._v("postinstall")]),t._v(" 钩子外，开发者还可以定义如下这些钩子：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("名称")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("执行时机")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("preinstall")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("包安装之前")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("postinstall")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("包安装之后")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("preuninstall")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("包卸载之前")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("postuninstall")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("包卸载之后")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("poststart")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("当 npm start 执行后")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("posttest")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("当 npm test 执行后")])])])]),t._v(" "),a("p",[t._v("所以在安装完 Electron 依赖包后，还会继续执行 "),a("code",[t._v("node install.js")]),t._v(" 脚本，该脚本会去 GitHub 仓库中下载 Electron 的可执行文件及其依赖的二进制文件：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" downloadArtifact "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'@electron/get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("downloadArtifact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需要下载的 Electron 可执行程序的版本号")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("artifactName")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'electron'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("force")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("force_no_cache "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 强制重新下载文件")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cacheRoot")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("electron_config_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置为 Electron 使用远程 SHASUMS256.txt 文件来验证校验和")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("checksums")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("electron_use_remote_checksums "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./checksums.json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  platform"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作系统的名称")]),t._v("\n  arch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 操作系统的架构：x32 / x64")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("上述信息最终会被组装成下载地址，主要分为三部分（每个部分都有其默认值，也有对应的重写该部分值的环境变量）：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("https:// github.com/electron/electron/releases/download/v13.1.6/electron-v13.1.6-win32-x64.zip\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# url = ELECTRON_MIRROR + ELECTRON_CUSTOM_DIR + '/' + ELECTRON_CUSTOM_FILENAME")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 镜像部分（ELECTRON_MIRROR）：https://github.com/electron/electron/releases/download/。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 版本部分（ELECTRON_CUSTOM_DIR）：v13.1.6。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件部分（ELECTRON_CUSTOM_FILENAME）：electron-v13.1.6-win32-x64.zip")]),t._v("\n")])])]),a("p",[t._v("下载的可执行文件会被放到通过 "),a("code",[t._v("os.tmpdir()")]),t._v(" 获取的临时目录下，下载完成后会将下载文件复制到缓存目录中。")]),t._v(" "),a("p",[t._v("默认的缓存目录是通过 "),a("code",[t._v("env-paths")]),t._v(" 模块获取的，开发者可以通过 "),a("code",[t._v("electron_config_cache")]),t._v(" 来自定义缓存目录。")]),t._v(" "),a("p",[t._v("所以目前来看，如果我们要解决上面的错误，我们可以通过以下两种方式来解决：")]),t._v(" "),a("ul",[a("li",[t._v("通过定义指定 URL 三部分的环境变量来设置下载路径；")]),t._v(" "),a("li",[t._v("把相关的资源直接放置到缓存目录中。")])]),t._v(" "),a("p",[a("code",[t._v("install")]),t._v(" 脚本获取到缓存目录下的压缩包后，会执行 "),a("code",[t._v("extractFile()")]),t._v(" 方法，此方法会把缓存目录下的二进制文件压缩包解压到当前 Electron 依赖包的 dist 目录下：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("project"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("node_modules"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("electron"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("dist\n")])])]),a("p",[t._v("至此，Electron 依赖包算是安装完成了。")])])}),[],!1,null,null,null);s.default=e.exports}}]);