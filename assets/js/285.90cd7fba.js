(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{698:function(t,a,e){"use strict";e.r(a);var s=e(62),v=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"基础命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础命令"}},[t._v("#")]),t._v(" 基础命令")]),t._v(" "),e("p",[t._v("FFmpeg 是一套可以用来记录、转换数字音频、视频，并能将其转化为流的开源计算机程序。它提供了录制、转换以及流化音视频的完整解决方案。")]),t._v(" "),e("h2",{attrs:{id:"命令分类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令分类"}},[t._v("#")]),t._v(" 命令分类")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("类别")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("基本信息查询命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("录制命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("分解/复用命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("处理原始数据命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("裁剪与合并命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("图片/视频互转命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("直播相关命令")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("各种滤镜命令")])])])]),t._v(" "),e("h2",{attrs:{id:"查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-version")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示版本")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-formats")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的格式")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-demuxers")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的 demuxers")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-protocols")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的协议")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-muxers")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的 muxers")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-fileters")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的过滤器")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-devices")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的设备")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-pix_fmts")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的像素格式")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-codes")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示所用编解码器")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-sample_fmts")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示可用的采样格式")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-decoders")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示所有的编辑器")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-layouts")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示 channel 名称")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-encoders")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示所有的编码器")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("-colors")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示识别的颜色名称")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("-bsfs")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("显示比特流")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}}),t._v(" "),e("td",{staticStyle:{"text-align":"left"}})])])]),t._v(" "),e("p",[t._v("比如查看可用的设备列表：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -devices "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 Mac 中的输出中会包含 avfoundation 数据输入设备")]),t._v("\n\n")])])]),e("h2",{attrs:{id:"录制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#录制"}},[t._v("#")]),t._v(" 录制")]),t._v(" "),e("p",[t._v("屏幕画面录制：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -f avfoundation -i "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -r "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" out.yuv\n")])])]),e("ul",[e("li",[t._v("-f: 指定使用 avfoundation 采集数据")]),t._v(" "),e("li",[t._v("-i: 指定输入来源，1 表示屏幕")]),t._v(" "),e("li",[t._v("-r: 指定帧率")]),t._v(" "),e("li",[t._v("out.yuv: 输出文件名称")])]),t._v(" "),e("p",[t._v("播放录制结果：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffplay -s 2880x1800 -pix_fmt uyvy422 out.yuv\n")])])]),e("ul",[e("li",[t._v("-s: 指定分辨率")]),t._v(" "),e("li",[t._v("-pix-fmt: 解码的格式，默认为 yuv420p")]),t._v(" "),e("li",[t._v("out.yuv: 指定播放文件名称")])]),t._v(" "),e("p",[t._v("那么上面的指定屏幕从何而来呢？我们可以通过下面的命令查看 AVFoundation 所支持的设备列表：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -f avfoundation -list_devices "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" -i "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 以下是截取的部分输出，可见包括视频设备和音频设备，前者索引为 1 所指的就是录屏")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [AVFoundation indev @ 0x7fb1a5522180] AVFoundation video devices:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [AVFoundation indev @ 0x7fb1a5522180] [0] FaceTime高清摄像头（内建）")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [AVFoundation indev @ 0x7fb1a5522180] [1] Capture screen 0")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [AVFoundation indev @ 0x7fb1a5522180] AVFoundation audio devices:")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [AVFoundation indev @ 0x7fb1a5522180] [0] MacBook Pro麦克风")]),t._v("\n")])])]),e("p",[t._v("音频录制：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -f avfoundation -i :0 out.wav\n")])])]),e("ul",[e("li",[t._v("-f: 指定使用 avfoundation 采集数据")]),t._v(" "),e("li",[t._v("-i: 指定输入来源，:0 表示音频中的索引为 0 的设备，冒号可以和视频设备区别开")]),t._v(" "),e("li",[t._v("out.wav: 输出文件名称")])]),t._v(" "),e("p",[t._v("播放音频：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffplay out.wav\n")])])]),e("h2",{attrs:{id:"分解和复用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#分解和复用"}},[t._v("#")]),t._v(" 分解和复用")]),t._v(" "),e("p",[t._v("多媒体格式转换：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -vcodec copy -acodec copy out.flv\n")])])]),e("ul",[e("li",[t._v("-i: 指定输入文件")]),t._v(" "),e("li",[t._v("-vcodec: 视频编码处理方式，copy 表示直接复用，之前是什么编码就是什么")]),t._v(" "),e("li",[t._v("-acodec: 音频编码处理方式")]),t._v(" "),e("li",[t._v("out.flv: 输出文件")])]),t._v(" "),e("p",[t._v("抽取视频：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -an -vcodec copy out.h264\n")])])]),e("ul",[e("li",[t._v("-an: 表示 audio not，即输出不包含音频")]),t._v(" "),e("li",[t._v("out.h264: 输出视频文件，后缀为视频的编码")])]),t._v(" "),e("p",[t._v("抽取音频：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -vn -acodec copy out.aac\n")])])]),e("ul",[e("li",[t._v("-vn: 表示 vedio not，即输出不包含视频")]),t._v(" "),e("li",[t._v("out.aac: 输出的音频文件，后缀为音频的编码")])]),t._v(" "),e("h2",{attrs:{id:"处理原始数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#处理原始数据"}},[t._v("#")]),t._v(" 处理原始数据")]),t._v(" "),e("p",[t._v("原始数据对于视频而言就是 YUV 数据，而音频则是 PCM 数据，它们没有经过任何编码。")]),t._v(" "),e("p",[t._v("提取 YUV 数据：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -an -c:v rawvideo -pix_fmt yuv420p out.yuv\n")])])]),e("ul",[e("li",[t._v("-c✌️ 指定 rawvideo 为视频的编码方式")]),t._v(" "),e("li",[t._v("-pix_fmt: 指定编码时的像素格式")])]),t._v(" "),e("p",[t._v("对原生视频数据进行播放：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffplay -f rawvideo -video_size 1280x720 -pix_fmt yuv420p out.yuv\n")])])]),e("ul",[e("li",[t._v("-f: 指定将视频转成原始数据")]),t._v(" "),e("li",[t._v("-video-size: 指定分辨率")]),t._v(" "),e("li",[t._v("-pix_fmt: 默认为 yuv420p，使用默认值则可省略")])]),t._v(" "),e("p",[t._v("提取 PCM 数据：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -vn -ar "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("44100")]),t._v(" -ac "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" -f s16le out.pcm\n")])])]),e("ul",[e("li",[t._v("-ar: 表示 audio rate，音频的采样率")]),t._v(" "),e("li",[t._v("-ac: 表示 audio channel，音频轨道")]),t._v(" "),e("li",[t._v("-f: 数据存储格式为 s16le (signed 16 bits little endian, 有符号 16 位小端)")])]),t._v(" "),e("p",[t._v("对原始音频进行播放：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 和播放 YUV 数据一样，播放 PCM 也需要指定一些参数值")]),t._v("\nffplay -ac "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" -ar "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("44100")]),t._v(" -f s16le out.pcm\n")])])]),e("h2",{attrs:{id:"裁剪与合并"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#裁剪与合并"}},[t._v("#")]),t._v(" 裁剪与合并")]),t._v(" "),e("p",[t._v("裁剪：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 从第 10 秒开始截取 10 秒的视频分段")]),t._v("\nffmpeg -i input.mp4 -ss 00:00:10 -t "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" fegment.ts\n")])])]),e("ul",[e("li",[t._v("-ss: 从什么时间点开始裁剪")]),t._v(" "),e("li",[t._v("-t: 裁剪多久的时间")])]),t._v(" "),e("p",[t._v("合并：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 当期目录下包含 1.ts 和 2.ts 两个文件")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在 inputs.txt 文件指定文件列表和就可以进行合并操作")]),t._v("\n\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" inputs.txt\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1.ts'")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2.ts'")]),t._v("\n\n$ ffmpeg -f concat -i inputs.txt out.mp4\n")])])]),e("ul",[e("li",[t._v("-f concat: 表示对后面的文件进行合并")]),t._v(" "),e("li",[t._v("-i inputs.txt: 指定了要拼接的内容，包含格式为 "),e("code",[t._v("file '<filename>'")]),t._v(" 的文件列表")])]),t._v(" "),e("h2",{attrs:{id:"图片和视频互转"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#图片和视频互转"}},[t._v("#")]),t._v(" 图片和视频互转")]),t._v(" "),e("p",[t._v("视频转图片：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -r "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -f image2 image-%3d.jpeg\n")])])]),e("ul",[e("li",[t._v("-r: 指定转换图片的帧率，为 1 表示每秒转出一张图片")]),t._v(" "),e("li",[t._v("-f: 指定转出图片的格式")]),t._v(" "),e("li",[t._v("image-%3d.jpeg: 输出文件的名称，%3d 表示 3 位数字")])]),t._v(" "),e("p",[t._v("图片转视频：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i image-%3d.jpeg out.mp4\n")])])]),e("h2",{attrs:{id:"推流和拉流"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推流和拉流"}},[t._v("#")]),t._v(" 推流和拉流")]),t._v(" "),e("p",[t._v("直播推流：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -re -i input.mp4 -c copy -f flv rtmp://server/live/streamName\n")])])]),e("ul",[e("li",[t._v("-re: 减慢帧率速度，保证和真实的帧率一致")]),t._v(" "),e("li",[t._v("-c: 指定音视频的编解码，单独指定音频使用 -a，使用 -v 则可以单独为视频指定")]),t._v(" "),e("li",[t._v("-f: 指定推出流的格式")]),t._v(" "),e("li",[t._v("rtmp://server/live/streamName: 指定 rtmp 服务器的地址")])]),t._v(" "),e("p",[t._v("直播拉流：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i rtmp://server/live/streamName -c copy dump.flv\n")])])]),e("p",[t._v("当然也可以对 HTTP 协议直播源进行处理，比如：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i http://server/live/streamName -c copy dump.m3u8\n")])])]),e("p",[t._v("对于 RTMP、RTSP、HTTP 视频协议直播流地址都可以使用 FFplay 直接进行播放。")]),t._v(" "),e("h2",{attrs:{id:"滤镜命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#滤镜命令"}},[t._v("#")]),t._v(" 滤镜命令")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("ffmpeg -i input.mp4 -vf "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("crop")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("in_w-200:in_h-200 -c:v libx264 -c:a copy out.mp4\n")])])]),e("ul",[e("li",[t._v("-vf: 表示 video filter，指定 crop 作为视频的滤镜，同时指定一些参数（in_w-200: 宽度减去 200，in_h-200: 高度减去 200）")]),t._v(" "),e("li",[t._v("-c🅰️ 指定音频的编码")])]),t._v(" "),e("p",[t._v("滤镜 "),e("code",[t._v("crop")]),t._v(" 的参数后面还可以指定起始的位置，格式为："),e("code",[t._v("out_w:out_h:x:y")]),t._v("，上面 "),e("code",[t._v("in_w")]),t._v(" 表示视频的宽度，"),e("code",[t._v("in_h")]),t._v(" 表示视频的高度。")])])}),[],!1,null,null,null);a.default=v.exports}}]);