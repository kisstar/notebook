(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{673:function(t,e,a){"use strict";a.r(e);var l=a(62),s=Object(l.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"添加水印"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加水印"}},[t._v("#")]),t._v(" 添加水印")]),t._v(" "),a("p",[t._v("水印可以是图片也可以是文字，主要用来标记视频所属标记。")]),t._v(" "),a("h2",{attrs:{id:"文字水印"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文字水印"}},[t._v("#")]),t._v(" 文字水印")]),t._v(" "),a("p",[t._v("添加文字水印需要有文字字库处理的相关文件：在编译 FFmpeg 时需要支持 FreeType、FontConfig 和 iconv，系统中要有相关的字库。")]),t._v(" "),a("p",[t._v("你可以通过 brew 命令来查看当前 FFmpeg 的支持情况，其中打勾的表示已经支持：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ brew info ffmpeg\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" Dependencies\nBuild: nasm ✘, pkg-config ✔\nRequired: aom ✔, dav1d ✔, fontconfig ✔, freetype ✔, frei0r ✔, gnutls ✔, lame ✔, libass ✔, libbluray ✔, libsoxr ✔, libvidstab ✔, libvorbis ✔, libvpx ✔, opencore-amr ✔, openjpeg ✔, opus ✔, rav1e ✔, rtmpdump ✔, rubberband ✔, sdl2 ✔, snappy ✔, speex ✔, srt ✔, tesseract ✔, theora ✔, webp ✔, x264 ✔, x265 ✔, xvid ✔, xz ✔\n")])])]),a("p",[t._v("增加纯字母水印可以使用 drawtext 滤镜进行支持，下面是该滤镜相关的参数：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("变量")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("fontfile")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字体文件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("text")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("文字")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("textfile")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("文字文件")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("fontcolor")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("色彩")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字体颜色")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("box")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("布尔")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("文字区域背景框")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("boxcolor")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("色彩")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字体颜色")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("fontsize")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("显示字体的大小")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("font")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字体名称，默认为 Sans 字体")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("x")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("文字显示的 x 坐标")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("y")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("文字显示的 y 坐标")])])])]),t._v(" "),a("p",[t._v("例如，在视频的右上角添加文字水印：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"drawtext=fontsize=100:fontfile=FreeSerif.ttf:text='hello world':x=20:y=20\"")]),t._v(" output.mp4\n")])])]),a("p",[t._v("如果需要指定中文水印，则在系统中需要包含中文字库与中文编码支持才行：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -re -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"drawtext=fontsize=100:fontfile=/Library/Fonts/Songti.ttc:text='你好，世界':x=20:y=20\"")]),t._v(" output.mp4\n")])])]),a("p",[t._v("另外，以本地时间作为水印内容也可以通过特殊用法来实现，甚至可以指定定时显示和定时不显示（通过 enable 配合）：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"drawtext=fontsize=100:fontfile=FreeSerif.ttf:text='%{localtime\\:%Y\\-%m\\-%d %H-%M-%S}':x=20:y=20:enable=lt(mod(t\\,3)\\,1)\"")]),t._v(" output.mp4\n")])])]),a("p",[t._v("执行上面的命令将会以本地时间作为水印，同时没三秒钟闪现一下水印的内容。")]),t._v(" "),a("h2",{attrs:{id:"图片水印"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#图片水印"}},[t._v("#")]),t._v(" 图片水印")]),t._v(" "),a("p",[t._v("除了添加简单的文字水印外，还可以添加图片水印、视频跑马灯等，主要使用的是 movie 滤镜，其相关参数如下：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("变量")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("filename")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输入的文件名，可以是文件、协议、设备")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("format_name,f")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输入的封装格式")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("stream_index")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输入的流索引编号")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("seek_point,sp")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("浮点数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Seek 输入流的时间位置")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("stream,s")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("输入的多个流的流信息")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("loop")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("循环次数")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("discontinuity")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("时间差值")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("支持跳动的时间戳差值")])])])]),t._v(" "),a("p",[t._v("通过 filter 读取输入文件的流可以指定为水印，这里主要说的是通过 movie 指定水印的方式：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"movie=input.png[wm]; [in][wm]overlay=30:10[out]"')]),t._v(" ouput.mp4\n")])])]),a("p",[t._v("执行上面的命令将会将图片添加视频中，其中 "),a("code",[t._v("30:10")]),t._v(" 表示起始位置的横纵坐标。")]),t._v(" "),a("p",[t._v("通过与 colorkey 滤镜配合可以呈现出半透明的效果：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"movie=input.png,colorkey=black:1.0:1.0[wm]; [in][wm]overlay=30:10[out]"')]),t._v(" ouput.mp4\n")])])]),a("p",[t._v("最终将会根据 colokey 设置的颜色值、相似度、混合度与原片混合为半透明水印。")]),t._v(" "),a("h2",{attrs:{id:"画中画"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#画中画"}},[t._v("#")]),t._v(" 画中画")]),t._v(" "),a("p",[t._v("通过 overlay 可以将多个视频流、多个视频文件、多个多媒体采集设备合并到一个界面中，生成画中画的效果，下面是其相关的一些参数：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("变量")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("x")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("x 坐标")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("y")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("y 坐标")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("eof_action")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("遇到 eof 标志时的处理方式，默认为重复。"),a("ul",[a("li",[t._v("repeat（值为 0）：重复前一帧")]),a("li",[t._v("endall（值为 1）：停止所有的流")]),a("li",[t._v("pass（值为 2）：保留主图层")])])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("shortest")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("布尔")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("终止最短的视频时全部终止（默认关闭）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("format")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("设置 output 的像素格式，默认为 yuv420。"),a("ul",[a("li",[t._v("yuv420（值为 0）")]),a("li",[t._v("yuv422（值为 1）")]),a("li",[t._v("yuv444（值为 2）")]),a("li",[t._v("rgb（值为 3）")])])])])])]),t._v(" "),a("p",[t._v("在滤镜的使用中还有很多组合的参数可以使用，可以使用一些内部变量，例如 overlay 图层的宽、高、坐标等。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -re -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"movie=sub.mp4,scale=480x320[test]; [in][test]overlay [out]"')]),t._v(" -vcodec libx264 ouput.flv\n")])])]),a("p",[t._v("如果需要指定子视频的显示位置则需要用到 overlay 中的 x 坐标和 y 坐标的内部变量，如设置 "),a("code",[t._v("overlay=x=main_w-480:y=main_h-320")]),t._v("，子视频会定位在主画面最右边减去视频的宽度，最小边减去视频的高度的位置，也就是右下角。")]),t._v(" "),a("p",[t._v("除了静态位置处理外，还可以使用 overlay 配合正则表达式进行跑马灯式画中画处理，即动态改变子画面的横纵坐标：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("ffmpeg -re -i input.mp4 -vf "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\"movie=sub.mp4,scale=480x320[test]; [in][test]overlay=x='if(gte(t,2), -w+(t-2)*20, NAN):y=0' [out]\"")]),t._v(" -vcodec libx264 ouput.flv\n")])])]),a("h2",{attrs:{id:"demo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[t._v("#")]),t._v(" Demo")]),t._v(" "),a("p",[t._v("文字水印: "),a("a",{attrs:{href:"https://github.com/kisstar/notebook/blob/master/tests/video/ffmpeg/filter/watermark.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/kisstar/notebook/blob/master/tests/video/ffmpeg/filter/watermark.js"),a("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=s.exports}}]);